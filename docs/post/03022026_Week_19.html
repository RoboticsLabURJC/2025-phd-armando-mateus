<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Armando Mateus Week 19</title>
  <link rel="stylesheet" href="../style.css">
</head>
<body>
  <header class="site-header">
    <div class="header-container">
      <img src="../images/logo.png" alt="Logo" class="logo">
      <div class="header-text">
        <h1>Robotics Lab URJC</h1>
        <p>Programming Robot Intelligence</p>
      </div>
    </div>
    <nav>
      <a href="../index.html">Home</a>
    </nav>
  </header>

  <main class="container">
    <article class="post">
      <h2>Week 19 – Dataset Balance Analysis and Latency Issue Investigation</h2>
      <p class="date">February 3, 2026</p>
      <p><strong>Comprehensive dataset balancing strategies and identification of steering latency problems in the data acquisition pipeline</strong></p>

      <p>Week 19 focused on advanced dataset analysis and correction of critical issues identified in the data collection process. Following Enrique Shinohara's Master's work methodology, a detailed examination of dataset distribution and steering latency problems was conducted.</p>

      <h3>1. Dataset Balancing Strategies Implementation</h3>
      <p>Inspired by Enrique Shinohara's approach, I performed a detailed analysis of data distribution across 48 steering categories ranging from -0.7 (sharp left) to 0.7 (sharp right). The categories were defined with intervals of 0.025: (-0.7, -0.675), (-0.675, -0.65), etc.</p>

      <p>Three balancing strategies were implemented and compared:</p>

      <div class="dataset-analysis">
        <div class="strategy-section">
          <h4>1. Original Dataset Distribution</h4>
        <div class="strategy-section">
        <div class="image-placeholder">
            <img src="week19_Fig1.png" alt="Undersampling distribution" class="blog-image" style="width: 700px; height: auto;">
              </div>

            <p class="image-caption">Figure 1: Dataset distribution after applying undersampling strategy</p>
          <p>The initial dataset showed significant imbalance with overrepresentation of certain steering values and underrepresentation of others, leading to model biases.</p>




          <h4>2. Undersampling Strategy</h4>
            <img src="week19_Fig2.png" alt="Undersampling distribution" class="blog-image" style="width: 700px; height: auto;">
            <p class="image-caption">Figure 2: Dataset from undersampling strategy.</p>
        </div>
          <p>This approach reduces the number of samples in overrepresented categories to create a more balanced distribution.</p>
        </div>

        <div class="strategy-section">
          <h4>3. Oversampling Strategy</h4>

            <img src="week19_Fig3.png" alt="Undersampling distribution" class="blog-image" style="width: 700px; height: auto;">
            <p class="image-caption">Figure 3: Dataset from oversampling strategy.</p>
        </div>


          <p>This method increases samples in underrepresented categories through duplication or synthetic data generation.</p>
        </div>

        <div class="strategy-section">
          <h4>4. Weighted Strategy</h4>
          <p>A weighted approach where samples from underrepresented categories receive higher weights during training.</p>
        </div>
      </div>

      <div class="comparison-chart">
        <div class="image-placeholder">
          <img src="week19_Fig4.png" alt="Balance strategies comparison" class="blog-image" style="width: 800px; height: auto;">
          <p class="image-caption">Figure 2: Comparison of three balancing strategies: Undersampling, Oversampling, and Weighted approach</p>
        </div>
      </div>

      <p><strong>Initial Training Results:</strong> All three balancing strategies were implemented and corresponding training sessions were conducted. However, three persistent adverse effects remained across all approaches:</p>
      
      <div class="problem-list">
        <div class="problem-item">
          <h4>1. Zigzagging Behavior</h4>
          <p>Model exhibits oscillatory steering corrections even in straight road segments.</p>
        </div>
        <div class="problem-item">
          <h4>2. Lane Departures</h4>
          <p>Unexpected exits from the lane, particularly in straight sections.</p>
        </div>
        <div class="problem-item">
          <h4>3. Incorrect Turns</h4>
          <p>Mistimed or improperly executed turns at curves.</p>
        </div>
      </div>

      <h3>2. Critical Dataset Construction Issues Identified</h3>
      <p>Research into PilotNet documentation revealed that these symptoms commonly indicate specific dataset problems:</p>
      
      <ul>
        <li><strong>Zigzagging</strong>: Typically caused by noise in the dataset</li>
        <li><strong>Lane Departures</strong>: Often result from insufficient samples with steering ≈ 0</li>
        <li><strong>Incorrect Turns</strong: Usually due to inadequate samples for specific turning scenarios</li>
      </ul>

      <p>Further investigation of the dataset uncovered a significant technical issue:</p>

      <div class="latency-analysis">
        <h4>Steering Latency Discovery</h4>
        <p>Analysis of consecutive frames revealed a systematic latency between steering commands and vehicle response:</p>
        
        <div class="code-example">
          <pre>
2025-12-04T18_36_12-111464.jpg 0.1005
2025-12-04T18_36_12-161632.jpg 0.1053
2025-12-04T18_36_12-211651.jpg 0.1101
2025-12-04T18_36_12-261667.jpg 0.1142
2025-12-04T18_36_12-311761.jpg 0.1171
2025-12-04T18_36_12-361465.jpg 0.1189
2025-12-04T18_36_12-411711.jpg 0.1202
2025-12-04T18_36_12-461495.jpg
2025-12-04T18_36_12-511498.jpg 0.1217
2025-12-04T18_36_12-561665.jpg 0.1225
          </pre>
          <p class="code-caption">Consecutive images with incrementally increasing steering values despite essentially identical visual content</p>
        </div>
        
        <p><strong>Key Finding:</strong> All these images are essentially identical visually, but the steering value increases progressively. This indicates a system latency of approximately 0.5 seconds between command issuance and vehicle response.</p>
        
        <p><strong>Implication:</strong> Since we aim to develop a reactive system, this latency is causing significant problems in model training and performance.</p>
      </div>

      <h4>Potential Causes Identified:</h4>
      <div class="cause-list">
        <div class="cause-item">
          <h5>1. Pygame Steering Acquisition Filtering</h5>
          <p>The Pygame function used for steering data acquisition may include filtering that introduces latency.</p>
        </div>
        <div class="cause-item">
          <h5>2. Warm-up Time Requirements</h5>
          <p>The system may require additional warm-up time before stable steering measurements are obtained.</p>
        </div>
      </div>

      <h3>3. Corrective Actions and Implementation Plan</h3>
      <p>Based on the identified issues, the following corrective strategies have been developed:</p>

      <div class="action-plan">
        <div class="action-item">
          <h4>1. Consecutive Frame Reduction</h4>
          <p>Remove consecutive images that don't represent appreciable changes, keeping only one representative frame and averaging corresponding steering values.</p>
        </div>

        <div class="action-item">
          <h4>2. Specialized Dataset Construction</h4>
          <p>Create specific datasets for different driving scenarios:</p>
          <ul>
            <li><strong>Straight-line driving dataset</strong></li>
            <li><strong>Turning maneuvers dataset</strong></li>
            <li><strong>Correction maneuvers dataset</strong></li>
          </ul>
          <p>This approach allows more efficient addressing of inertia and warm-up effects produced by vehicle dynamics.</p>
        </div>

        <div class="action-item">
          <h4>3. Dataset-Specific Processing Pipeline</h4>
          <p>For each specialized dataset, implement three specific processing steps:</p>
          
          <div class="processing-steps">
            <div class="step">
              <h5>Step 1: Warm-up Period Removal</h5>
              <p>Eliminate the first 1 second of driving (20 frames) to avoid warm-up effects.</p>
            </div>
            
            <div class="step">
              <h5>Step 2: Redundant Frame Elimination</h5>
              <p>Remove consecutive images without significant changes. Since driving logs contain vehicle position and orientation data, we compare entries with closely matching positional data rather than directly analyzing images. This addresses effects due to inertia.</p>
            </div>
            
            <div class="step">
              <h5>Step 3: Anomaly Filtering</h5>
              <p>Filter values inconsistent with the driving type. For example, straight-line driving should have steering values between -0.04 and 0.04. Values outside these limits are considered anomalous and removed.</p>
            </div>
          </div>
        </div>
      </div>

      <div class="current-status">
        <h4>Current Progress</h4>
        <p>A new dataset is currently being constructed incorporating all these corrective actions. Initial tests with steering = 0 (straight-line driving) are being conducted to validate the approach.</p>
        
        <div class="next-steps">
          <h5>Immediate Next Steps:</h5>
          <p>• Complete the new dataset construction with corrected data</p>
          <p>• Launch training sessions with the cleaned dataset</p>
          <p>• Compare performance between different balancing strategies on the corrected data</p>
          <p>• Further investigate and potentially modify the Pygame steering acquisition pipeline</p>
        </div>
      </div>

      <div class="online-results">
        <h4>KEY FINDINGS THIS WEEK:</h4>
        <p>• Implemented three dataset balancing strategies following Shinohara's methodology</p>
        <p>• Identified persistent model issues: zigzagging, lane departures, incorrect turns</p>
        <p>• Discovered critical 0.5-second steering latency in data acquisition</p>
        <p>• Developed comprehensive corrective action plan for dataset reconstruction</p>
        <p>• New specialized datasets under construction with anomaly filtering</p>
        <p>• Initial straight-line driving tests initiated to validate corrections</p>
      </div>

      <p><strong>Conclusion:</strong><br>
        Week 19 revealed fundamental issues in our data acquisition pipeline, particularly regarding steering latency. While balancing strategies alone didn't resolve model performance problems, the identification of systematic latency provides a clear path forward. The current dataset reconstruction effort, incorporating specialized scenario datasets and rigorous filtering, aims to create a cleaner, more reliable training foundation. Success in this correction phase is crucial for achieving stable, predictable autonomous driving behavior.</p>
    </article>
  </main>

  <footer class="site-footer">
    <p>© 2026 – Academic Blog by Armando Mateus</p>
  </footer>

  <style>
    .online-results, .next-steps, .current-status {
      background-color: #f5f5f5;
      border-left: 4px solid #4a6fa5;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }
    
    .online-results h4, .next-steps h5, .current-status h4 {
      margin-top: 0;
      color: #2c3e50;
      border-bottom: 1px solid #ddd;
      padding-bottom: 5px;
    }
    
    .image-caption, .code-caption {
      font-style: italic;
      color: #666;
      text-align: center;
      margin-top: 8px;
      font-size: 0.9em;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .dataset-analysis, .problem-list, .cause-list, .action-plan {
      margin: 25px 0;
    }
    
    .strategy-section, .problem-item, .cause-item, .action-item {
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }
    
    .strategy-section:last-child, .problem-item:last-child, 
    .cause-item:last-child, .action-item:last-child {
      border-bottom: none;
    }
    
    .strategy-section h4, .problem-item h4, .cause-item h5, .action-item h4 {
      color: #2c3e50;
      margin-bottom: 10px;
    }
    
    .latency-analysis {
      background-color: #fff8e1;
      border-left: 4px solid #ffb300;
      padding: 20px;
      margin: 25px 0;
      border-radius: 4px;
    }
    
    .latency-analysis h4 {
      color: #e65100;
      margin-top: 0;
    }
    
    .code-example {
      background-color: #2c3e50;
      color: #ecf0f1;
      padding: 15px;
      border-radius: 4px;
      margin: 15px 0;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }
    
    .code-example pre {
      margin: 0;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    
    .comparison-chart {
      text-align: center;
      margin: 30px 0;
    }
    
    .processing-steps {
      margin-left: 20px;
    }
    
    .step {
      margin: 15px 0;
      padding-left: 15px;
      border-left: 3px solid #4a6fa5;
    }
    
    .step h5 {
      margin-top: 0;
      color: #2c3e50;
    }
    
    .post h3 {
      color: #2c3e50;
      margin: 30px 0 20px 0;
      border-bottom: 2px solid #4a6fa5;
      padding-bottom: 10px;
    }
    
    .post h4 {
      color: #2c3e50;
      margin: 25px 0 15px 0;
    }
    
    ul {
      margin: 15px 0;
      padding-left: 30px;
    }
    
    li {
      margin: 8px 0;
      line-height: 1.5;
    }
    
    .blog-image {
      display: block;
      max-width: 100%;
      height: auto;
      margin: 20px auto;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
  </style>
</body>
</html>
